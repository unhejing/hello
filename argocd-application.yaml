# ArgoCD Application 配置
# 
# 说明：
# - 如果是在 ArgoCD UI 中手动创建的应用，这个文件是可选的
# - 但建议保留，作为配置的备份和文档
# - 可以用于版本控制、团队共享、快速重建应用
#
# 使用方法：
# - 如果需要用这个文件创建/更新应用：kubectl apply -f argocd-application.yaml
# - 如果应用已在 UI 中创建，这个文件仅作为参考文档

apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: hello-app
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: https://github.com/unhejing/hello.git  # 修改为你的 Git 仓库地址
    targetRevision: main  # 修改为你的分支名
    path: .
    # 使用 Helm + Kustomize 组合
    # 关键：需要同时指定 helm 和 kustomize
    helm:
      releaseName: hello-app
      # 如果需要指定 values 文件
      # valueFiles:
      #   - values.yaml
    # Kustomize 会对 Helm 生成的资源进行处理
    # kustomization.yaml 中的 commonAnnotations 和 commonLabels 会应用到 Helm 生成的资源
    kustomize:
      # Kustomize 会自动读取 kustomization.yaml
    # 重要：需要在 ArgoCD ConfigMap 中启用 kustomize.buildOptions: --enable-helm
    # 执行: bash setup-helm-kustomize.sh
  destination:
    # server: https://kubernetes.default.svc
    namespace: default
    # 注意：不能同时指定 name 和 server
    # 如果使用 name，需要先在 ArgoCD 中注册集群
    name: in-cluster  # 不要同时使用
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m

